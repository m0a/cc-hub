# Feature Specification: CC Hub

**Feature Branch**: `001-cc-hub`
**Created**: 2026-01-24
**Status**: Draft
**Input**: Web-based Claude Code multi-session management hub with terminal access from any device

## User Scenarios & Testing *(mandatory)*

### User Story 1 - ターミナルアクセス (Priority: P1)

ユーザーとして、WebブラウザからターミナルにアクセスしてシェルコマンドやClaude Codeを実行したい。これにより、どのデバイスからでも開発作業を継続できる。

**Why this priority**: これがCC Hubの核心機能。ターミナルアクセスなしでは他の機能が成り立たない。

**Independent Test**: ブラウザでCC Hubにアクセスし、ターミナル画面でコマンドを入力・実行できることを確認する。

**Acceptance Scenarios**:

1. **Given** ユーザーがCC HubのURLにアクセスしている, **When** ターミナル画面が表示される, **Then** コマンドプロンプトが表示され入力可能な状態になる
2. **Given** ターミナルが表示されている, **When** `ls`コマンドを入力してEnterを押す, **Then** ディレクトリ一覧が表示される
3. **Given** ターミナルが表示されている, **When** `claude`コマンドを入力してEnterを押す, **Then** Claude Codeが起動する
4. **Given** ターミナルでコマンドを実行中, **When** ブラウザをリロードする, **Then** 実行中のコマンドは継続し、出力履歴が復元される

---

### User Story 2 - セッション永続化 (Priority: P2)

ユーザーとして、ブラウザを閉じても実行中のタスクが継続してほしい。別のデバイスから再接続したときに、同じセッションに戻りたい。

**Why this priority**: マルチデバイス対応の基盤。P1のターミナル機能が動作した後に必要になる。

**Independent Test**: PCでセッションを開始し、ブラウザを閉じ、スマートフォンから同じセッションにアクセスして継続できることを確認する。

**Acceptance Scenarios**:

1. **Given** ターミナルで長時間タスクを実行中, **When** ブラウザを閉じる, **Then** サーバー側でタスクは継続実行される
2. **Given** 以前開始したセッションがある, **When** 別のデバイスからCC Hubにアクセスする, **Then** 既存セッションの一覧が表示され選択できる
3. **Given** セッション一覧が表示されている, **When** 既存セッションを選択する, **Then** そのセッションにアタッチされ、過去の出力履歴が表示される

---

### User Story 3 - マルチセッション管理 (Priority: P3)

ユーザーとして、複数のセッションをタブで切り替えながら並行して作業したい。各セッションの状態（処理中、入力待ちなど）を一目で把握したい。

**Why this priority**: 生産性向上のための機能。基本機能（P1, P2）が安定した後に実装。

**Independent Test**: 3つのセッションを作成し、タブで切り替えながらそれぞれでコマンドを実行できることを確認する。

**Acceptance Scenarios**:

1. **Given** CC Hubにアクセスしている, **When** 「新規セッション」ボタンをクリックする, **Then** 新しいセッションが作成されタブに追加される
2. **Given** 複数のセッションタブがある, **When** 別のタブをクリックする, **Then** そのセッションのターミナル画面に切り替わる
3. **Given** あるセッションでClaude Codeが入力待ち状態, **When** タブ一覧を見る, **Then** そのセッションのタブが赤色（入力待ち）で表示される
4. **Given** あるセッションでClaude Codeが処理中, **When** タブ一覧を見る, **Then** そのセッションのタブが黄色（処理中）で表示される

---

### User Story 4 - 通知 (Priority: P4)

ユーザーとして、Claude Codeが入力を待っているときや長時間タスクが完了したときに通知を受け取りたい。これにより、他の作業をしながらでもタイミングを逃さない。

**Why this priority**: ユーザー体験向上のための追加機能。Android/Desktopで先行対応。

**Independent Test**: Claude Codeで質問が表示されたとき、ブラウザ通知またはプッシュ通知が届くことを確認する。

**Acceptance Scenarios**:

1. **Given** 通知許可を求められている, **When** 許可する, **Then** 通知設定が有効になる
2. **Given** 通知が有効でブラウザがバックグラウンド, **When** Claude Codeが入力を待っている状態になる, **Then** プッシュ通知が届く（Android/Desktop）
3. **Given** 通知が有効でブラウザがフォアグラウンド, **When** Claude Codeが入力を待っている状態になる, **Then** アプリ内通知が表示される

---

### Edge Cases

- ネットワーク切断時、自動的に再接続を試み、接続が復旧したらセッションを復元する
- サーバーが再起動した場合、既存のtmuxセッションが失われるため、ユーザーに新規セッション作成を促す
- 同じセッションに複数のブラウザタブから同時接続した場合、すべてのタブで同じ内容が表示される（入力は最後に入力したタブが反映）
- セッションは自動終了せず、ユーザーが明示的に削除するまで維持される

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムはWebブラウザ経由でターミナル操作を提供しなければならない
- **FR-002**: ユーザーはターミナルでシェルコマンドを実行できなければならない
- **FR-003**: ユーザーはターミナルでClaude Codeを起動・操作できなければならない
- **FR-004**: システムはブラウザ切断後もセッションを維持しなければならない
- **FR-005**: ユーザーは既存セッションに再接続できなければならない
- **FR-006**: ユーザーは複数のセッションを作成・管理できなければならない
- **FR-007**: システムはセッション一覧をタブUIで表示しなければならない
- **FR-008**: システムは各セッションのClaude Code状態を検出し、タブの色で表示しなければならない
- **FR-009**: システムはClaude Codeの入力待ち・許可待ち状態を通知しなければならない（Android/Desktop）
- **FR-010**: システムはレスポンシブデザインでPC・タブレット・スマートフォンに対応しなければならない
- **FR-011**: ユーザーは認証を経てCC Hubにアクセスしなければならない

### Key Entities

- **Session**: ユーザーのターミナルセッション。名前、作成日時、最終アクセス日時、状態（idle/working/waiting_input/waiting_permission）を持つ
- **User**: CC Hubを利用するユーザー。認証情報とセッションの所有関係を持つ
- **Notification**: ユーザーへの通知。種別（入力待ち、許可待ち、タスク完了、エラー）と対象セッションを持つ

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーはページロード後3秒以内にターミナルでコマンド入力を開始できる
- **SC-002**: ブラウザ切断から再接続まで、セッションの実行状態が100%維持される
- **SC-003**: デバイス間でのセッション切り替え（PC→スマートフォン）が10秒以内に完了する
- **SC-004**: Claude Codeの状態変化から2秒以内にタブの色が更新される
- **SC-005**: 入力待ち通知は状態変化から5秒以内にユーザーに届く（Android/Desktop）
- **SC-006**: 10個のセッションを同時管理しても操作に遅延が感じられない
- **SC-007**: スマートフォン（画面幅360px以上）でターミナル操作が可能

## Clarifications

### Session 2026-01-24

- Q: ユーザー数の想定は？ → A: 個人利用（1-3ユーザー）：シンプルな認証、権限管理なし
- Q: 認証方式の詳細は？ → A: パスワード認証（シンプルなユーザー名/パスワード）
- Q: 通信のセキュリティは？ → A: Tailscale HTTPS（VPN内運用、Tailscaleが証明書を提供）
- Q: アイドルセッションの扱いは？ → A: 無期限（手動削除のみ、自動終了なし）

## Assumptions

- ユーザーはサーバーにSSHまたは物理アクセスできる環境でCC Hubをセットアップする
- サーバーにはtmuxがインストールされている
- Claude Codeは事前にサーバーにインストール・認証済みである
- ユーザーは安定したインターネット接続を持つ（オフライン動作は考慮しない）
- Tailscale VPN内での運用を前提とし、Tailscale HTTPSで通信を暗号化する
- 認証方式はユーザー名/パスワードによるセッションベース認証を採用する
- 個人利用（1-3ユーザー）を想定し、ロール・権限管理は実装しない
- iOSでは通知機能を提供しない（プラットフォーム制限のため）
